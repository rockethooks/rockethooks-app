## Part of Epic #67: Streamlined Onboarding

### üìã Task Description
Create an elegant card-based component for users to select between Solo Developer and Team usage, which submits along with the organization name to create the organization.

### üéØ Acceptance Criteria
- [ ] Display pre-filled organization name (editable)
- [ ] Two visually distinct cards (Solo Developer / Team)
- [ ] Submit organization creation with name + usage type
- [ ] Handle backend response including example monitors
- [ ] Navigate to dashboard after successful creation
- [ ] Mobile responsive design
- [ ] Accessibility compliant (WCAG 2.1 AA)
- [ ] ~~Analytics tracking~~ (excluded per planning discussion)

---

## üìê Technical Implementation Plan

### üö® Context from PR #78
PR #78 has partially implemented some components:
- ‚úÖ `OrganizationNameEdit` exists with basic button-based usage type selection
- ‚úÖ Organization name generator using `tldts` package
- ‚ùå Needs transformation from buttons to cards
- ‚ùå Missing GraphQL mutation
- ‚ùå Missing enhanced name generation with Faker.js

### üèóÔ∏è Architecture Decision: Option 2 - Create New Components

**Rationale**: Clean implementation matching exact design spec without legacy code
- **Impact**: Only one file needs updating (`OnboardingFlow.tsx`)
- **Migration**: Direct replacement, no deprecation needed

### üì¶ Component Structure

```
src/components/onboarding/
‚îú‚îÄ‚îÄ OrganizationSetup.tsx (NEW - Main container)
‚îú‚îÄ‚îÄ UsageCard.tsx (NEW - Reusable card component)
‚îî‚îÄ‚îÄ OrganizationNameEdit.tsx (DELETE after implementation)
```

### üîß Implementation Details

#### 1. OrganizationSetup Component (NEW)
**File**: `src/components/onboarding/OrganizationSetup.tsx`

```tsx
import { useState, useCallback } from 'react';
import { useMutation } from '@apollo/client';
import { Check, Pencil, User, Users, ArrowRight, Loader2 } from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';
import { UsageCard } from './UsageCard';
import { generateOrganizationName } from '@/utils/organizationNameGenerator';
import { CREATE_ORGANIZATION_WITH_EXAMPLES } from '@/graphql/mutations/organization';
import { loggers } from '@/utils';

const logger = loggers.onboarding;

interface OrganizationSetupProps {
  userEmail: string;
  onComplete: (orgId: string) => void;
}

export function OrganizationSetup({ userEmail, onComplete }: OrganizationSetupProps) {
  const [orgName, setOrgName] = useState(() => 
    generateOrganizationName(userEmail)
  );
  const [isEditing, setIsEditing] = useState(false);
  const [wasManuallyEdited, setWasManuallyEdited] = useState(false);
  const [isCreating, setIsCreating] = useState(false);
  
  const [createOrganization] = useMutation(CREATE_ORGANIZATION_WITH_EXAMPLES, {
    errorPolicy: 'all',
    onError: (error) => {
      logger.error('Failed to create organization', error);
      toast.error('Failed to create organization', {
        action: {
          label: 'Retry',
          onClick: () => handleUsageTypeSelect(lastUsageType)
        }
      });
    }
  });

  const handleUsageTypeSelect = async (usageType: 'solo' | 'team') => {
    setIsCreating(true);
    logger.info('Creating organization', { 
      name: orgName, 
      usageType,
      wasManuallyEdited 
    });

    try {
      const { data } = await createOrganization({
        variables: {
          input: {
            name: orgName.trim(),
            usageType,
            autoGenerated: !wasManuallyEdited
          }
        }
      });

      logger.success('Organization created', {
        orgId: data.createOrganization.organization.id,
        exampleMonitorCount: data.createOrganization.exampleMonitors.length
      });

      toast.success('Workspace created successfully!');
      onComplete(data.createOrganization.organization.id);
      
    } catch (error) {
      setIsCreating(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center p-6">
      <div className="max-w-4xl w-full">
        {/* Organization Name Section */}
        <div className="text-center mb-12">
          <h1 className="text-4xl font-bold mb-4">
            Welcome to{' '}
            {isEditing ? (
              <input
                type="text"
                value={orgName}
                onChange={(e) => {
                  setOrgName(e.target.value);
                  setWasManuallyEdited(true);
                }}
                onBlur={() => setIsEditing(false)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter') setIsEditing(false);
                  if (e.key === 'Escape') {
                    setOrgName(generateOrganizationName(userEmail));
                    setIsEditing(false);
                    setWasManuallyEdited(false);
                  }
                }}
                className="inline-block border-b-2 border-primary bg-transparent text-4xl font-bold focus:outline-none"
                autoFocus
              />
            ) : (
              <span 
                onClick={() => setIsEditing(true)}
                className="cursor-pointer hover:text-primary transition-colors inline-flex items-center group"
              >
                {orgName}
                <Pencil className="ml-2 h-6 w-6 opacity-0 group-hover:opacity-50 transition-opacity" />
              </span>
            )}
          </h1>
          <p className="text-lg text-muted-foreground">
            How will you use RocketHooks?
          </p>
        </div>

        {/* Usage Type Selection Cards */}
        <div className="grid md:grid-cols-2 gap-6">
          <UsageCard
            icon={<User className="h-12 w-12" />}
            title="Solo Developer"
            description="I'm building on my own"
            benefits={[
              "Personal workspace",
              "Quick setup, no team management",
              "Upgrade to team anytime",
              "Generous free tier"
            ]}
            onClick={() => handleUsageTypeSelect('solo')}
            disabled={isCreating}
            className="group"
          />

          <UsageCard
            icon={<Users className="h-12 w-12" />}
            title="Team"
            description="I'm working with others"
            benefits={[
              "Shared monitoring workspace",
              "Invite unlimited team members",
              "Role-based permissions",
              "Collaborative features"
            ]}
            onClick={() => handleUsageTypeSelect('team')}
            disabled={isCreating}
            className="group"
          />
        </div>

        {/* Loading State */}
        {isCreating && (
          <div className="mt-8 text-center">
            <Loader2 className="h-8 w-8 animate-spin mx-auto mb-2" />
            <p className="text-muted-foreground">
              Creating your workspace...
            </p>
          </div>
        )}

        <p className="text-center mt-8 text-sm text-muted-foreground">
          You can change these settings anytime
        </p>
      </div>
    </div>
  );
}
```

#### 2. UsageCard Component (NEW)
**File**: `src/components/onboarding/UsageCard.tsx`

```tsx
import { type ReactNode } from 'react';
import { Check, ArrowRight } from 'lucide-react';
import { cn } from '@/lib/utils';
import { Card } from '@/components/ui/Card';
import { cva, type VariantProps } from 'class-variance-authority';

const usageCardVariants = cva(
  'relative p-8 rounded-xl border-2 text-left transition-all duration-200 cursor-pointer',
  {
    variants: {
      state: {
        idle: 'hover:border-primary hover:scale-105 hover:shadow-lg',
        disabled: 'opacity-50 cursor-not-allowed hover:scale-100',
        loading: 'animate-pulse'
      }
    },
    defaultVariants: {
      state: 'idle'
    }
  }
);

interface UsageCardProps extends VariantProps<typeof usageCardVariants> {
  icon: ReactNode;
  title: string;
  description: string;
  benefits: string[];
  onClick: () => void;
  disabled?: boolean;
  className?: string;
}

export function UsageCard({ 
  icon, 
  title, 
  description, 
  benefits, 
  onClick,
  disabled = false,
  className,
  state
}: UsageCardProps) {
  return (
    <button
      onClick={onClick}
      disabled={disabled}
      className={cn(
        usageCardVariants({ state: disabled ? 'disabled' : state }),
        'focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2',
        className
      )}
      aria-label={`Select ${title} usage type`}
    >
      <div className="flex flex-col h-full">
        <div className="mb-6 text-primary">{icon}</div>
        
        <h3 className="text-2xl font-bold mb-2">{title}</h3>
        <p className="text-muted-foreground mb-6">{description}</p>
        
        <ul className="space-y-2 mt-auto" role="list">
          {benefits.map((benefit, i) => (
            <li key={i} className="flex items-start">
              <Check className="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" aria-hidden="true" />
              <span className="text-sm">{benefit}</span>
            </li>
          ))}
        </ul>
      </div>

      {!disabled && (
        <div className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
          <ArrowRight className="h-6 w-6 text-primary" aria-hidden="true" />
        </div>
      )}
    </button>
  );
}
```

#### 3. Enhanced Organization Name Generator
**File**: `src/utils/organizationNameGenerator.ts` (UPDATE)

```tsx
import { parse } from 'tldts';
import { faker } from '@faker-js/faker';

/**
 * Generate creative organization names using Faker.js
 */
function generateCreativeName(): string {
  const patterns = [
    () => `${faker.company.name()}-workspace`,
    () => `${faker.hacker.adjective()}-${faker.hacker.noun()}`,
    () => `${faker.color.human()}-${faker.animal.type()}-hub`,
    () => `${faker.word.adjective()}-rocket`,
    () => `${faker.commerce.department()}-central`,
    () => `project-${faker.science.chemicalElement().name.toLowerCase()}`
  ];
  
  const pattern = patterns[Math.floor(Math.random() * patterns.length)];
  return pattern()
    .toLowerCase()
    .replace(/[^a-z0-9-]/g, '-')
    .replace(/-+/g, '-')
    .replace(/^-|-$/g, '');
}

/**
 * Generate organization name with fallback strategies
 */
export function generateOrganizationName(email?: string): string {
  // Try email-based generation first
  if (email) {
    try {
      const [username, domain] = email.split('@');
      
      // Handle GitHub noreply emails
      if (domain === 'users.noreply.github.com') {
        return `${username.split('+')[1] || username}-workspace`;
      }
      
      // Extract company name from domain
      const parsed = parse(`https://${domain}`);
      if (parsed.domain && parsed.domain !== 'gmail' && parsed.domain !== 'outlook') {
        return `${parsed.domain}-workspace`;
      }
      
      // Personal email fallback
      return `${username.split(/[._+-]/)[0]}-workspace`;
      
    } catch (error) {
      // Fallback to creative generation
    }
  }
  
  // Creative generation as fallback
  return generateCreativeName();
}
```

#### 4. GraphQL Mutation
**File**: `src/graphql/mutations/organization.ts` (NEW)

```tsx
import { gql } from '@apollo/client';

export const CREATE_ORGANIZATION_WITH_EXAMPLES = gql`
  mutation CreateOrganizationWithExamples($input: CreateOrganizationInput!) {
    createOrganization(input: $input) {
      organization {
        id
        name
        usageType
        autoGenerated
        createdAt
      }
      exampleMonitors {
        id
        name
        endpoint
        webhookUrl
        isExample
        status
        interval
        timeout
      }
    }
  }
`;

export interface CreateOrganizationInput {
  name: string;
  usageType: 'solo' | 'team';
  autoGenerated: boolean;
}

export interface CreateOrganizationResponse {
  createOrganization: {
    organization: {
      id: string;
      name: string;
      usageType: string;
      autoGenerated: boolean;
      createdAt: string;
    };
    exampleMonitors: Array<{
      id: string;
      name: string;
      endpoint: string;
      webhookUrl: string;
      isExample: boolean;
      status: string;
      interval: number;
      timeout: number;
    }>;
  };
}
```

### üîÑ Migration Steps

1. **Install Dependencies**
   ```bash
   yarn add @faker-js/faker
   ```

2. **Create New Components**
   - Create `UsageCard.tsx`
   - Create `OrganizationSetup.tsx`
   - Update `organizationNameGenerator.ts`
   - Add GraphQL mutation

3. **Update OnboardingFlow.tsx**
   ```tsx
   // Replace import
   - import { OrganizationNameEdit } from './OrganizationNameEdit';
   + import { OrganizationSetup } from './OrganizationSetup';
   
   // Replace component usage
   - <OrganizationNameEdit ... />
   + <OrganizationSetup
   +   userEmail={context.userEmail || ''}
   +   onComplete={(orgId) => {
   +     // Handle completion
   +   }}
   + />
   ```

4. **Delete Old Component**
   ```bash
   rm src/components/onboarding/OrganizationNameEdit.tsx
   ```

5. **Test & Validate**
   - Run type checks: `yarn type-check`
   - Test the flow manually
   - Run quality checks: `yarn quality`

### üß™ Testing Requirements
- [ ] Organization name generation with various email formats
- [ ] Inline editing with keyboard shortcuts
- [ ] Card selection for both usage types
- [ ] GraphQL mutation error handling
- [ ] Loading states during creation
- [ ] Mobile responsiveness (stack cards on small screens)
- [ ] Keyboard navigation between cards
- [ ] Screen reader announcements

### üì± Responsive Design
- **Mobile** (<768px): Stack cards vertically
- **Tablet** (768px-1024px): Side-by-side cards
- **Desktop** (>1024px): Full card with all benefits visible

### ‚ôø Accessibility Requirements
- WCAG 2.1 AA compliant
- Keyboard navigable (Tab, Enter, Escape)
- ARIA labels on interactive elements
- Focus indicators on cards
- Screen reader friendly benefit lists
- Color contrast ratios meet standards

### üé® Design Tokens
```css
/* Card States */
--card-idle: default border, scale(1)
--card-hover: primary border, scale(1.05), shadow-lg
--card-disabled: opacity(0.5), no hover effects
--card-loading: animate-pulse

/* Transitions */
--transition-all: 200ms ease-in-out
```

### ‚ö†Ô∏è Important Considerations
- Organization names must be validated (3-50 chars, alphanumeric + hyphens)
- Handle network errors gracefully with retry mechanism
- Show clear loading state during organization creation
- Ensure mobile layout works well with touch interactions
- Consider adding tooltips for benefit explanations
- Validate email format before generating organization name

### üîó Dependencies
- ‚úÖ Task #69 (organization name generator) - Completed in PR #78
- ‚ö†Ô∏è Backend must support `createOrganization` mutation with example monitors
- ‚úÖ Apollo Client configured for GraphQL operations
- ‚úÖ Existing UI components (Card, Button, Icons)

### üìä Success Metrics
- User can edit organization name inline
- Both usage types are selectable
- Organization is created successfully
- Example monitors are returned from backend
- Navigation to dashboard works
- No TypeScript errors
- All quality checks pass

### ‚è±Ô∏è Estimated Time: 4-6 hours

---

## üîó Related Documentation
- [Technical Brainstorming Session](https://github.com/rockethooks/rockethooks-app/issues/70#issuecomment-xxx)
- [Framer Motion Enhancement Issue #79](https://github.com/rockethooks/rockethooks-app/issues/79)
- [PR #78 - Organization Name Generator](https://github.com/rockethooks/rockethooks-app/pull/78)

## üìù Notes
- This implementation uses **Option 2** from technical planning: Create new components
- The existing `OrganizationNameEdit` component will be deleted (minimal impact - only used in one file)
- Future enhancement with Framer Motion tracked in issue #79